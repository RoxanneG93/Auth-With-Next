{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport axios from 'axios';\nimport Router from 'next/router'; // gets the cookie data???\n\naxios.defaults.withCredentials = true;\nvar WINDOW_USER_SCRIPT_VARIABLE = '__USER__';\nexport var loginUser =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(email, password) {\n    var _ref2, data;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return axios.post('/api/login', {\n              email: email,\n              password: password\n            });\n\n          case 2:\n            _ref2 = _context.sent;\n            data = _ref2.data;\n\n            if (typeof window !== 'undefined') {\n              window[WINDOW_USER_SCRIPT_VARIABLE] = data || {};\n            }\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function loginUser(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var getUserProfile =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2() {\n    var _ref4, data;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return axios.get('/api/profile');\n\n          case 2:\n            _ref4 = _context2.sent;\n            data = _ref4.data;\n            return _context2.abrupt(\"return\", data);\n\n          case 5:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function getUserProfile() {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var getServerSideToken = function getServerSideToken(req) {\n  if (!req) {\n    return {};\n  }\n\n  var _req$signedCookies = req.signedCookies,\n      signedCookies = _req$signedCookies === void 0 ? {} : _req$signedCookies;\n\n  if (!signedCookies) {\n    return {};\n  } else if (!signedCookies.token) {\n    return {};\n  }\n\n  return {\n    user: signedCookies.token\n  };\n};\nexport var getClientSideToken = function getClientSideToken() {\n  // checking if we are not on the client window\n  if (typeof window !== 'undefined') {\n    var user = window[WINDOW_USER_SCRIPT_VARIABLE] || {};\n    return {\n      user: user\n    };\n  }\n\n  return {\n    user: []\n  };\n};\nexport var getUserScript = function getUserScript(user) {\n  return \"\".concat(WINDOW_USER_SCRIPT_VARIABLE, \" = \").concat(_JSON$stringify(user));\n};\n\nvar redirectcUser = function redirectcUser(res, path) {\n  if (res) {\n    // temporary redirect, significant for SEO??\n    res.redirect(302, path); // finished property tells Next to not keep writing to the response\n\n    res.finished = true;\n    return {};\n  }\n\n  Router.push;\n}; // higer order function running a function???\n\n\nexport var authInitialProps = function authInitialProps(isProtectedRoute) {\n  return function (_ref5) {\n    var req = _ref5.req,\n        res = _ref5.res;\n    var auth = req ? getServerSideToken(req) : getClientSideToken();\n    var currentPath = req ? req.url : window.location.pathname;\n    var user = auth.user;\n    var isAnonymous = !user || user.type !== 'authenticated';\n\n    if (isProtectedRoute && isAnonymous && currentPath !== \"/login\") {\n      return redirectcUser(res, '/login');\n    }\n\n    return {\n      auth: auth\n    };\n  };\n}; //\n\nexport var logoutUser =\n/*#__PURE__*/\nfunction () {\n  var _ref6 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3() {\n    var user;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            // checking if we are not on the client window\n            if (typeof window !== 'undefined') {\n              user = window[WINDOW_USER_SCRIPT_VARIABLE] = {};\n            }\n\n            _context3.next = 3;\n            return axios.post('/api/logout');\n\n          case 3:\n            Router.push('/login');\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function logoutUser() {\n    return _ref6.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["C:\\Users\\RxRbl\\Desktop\\Work\\NextAuth\\lib\\auth.js"],"names":["axios","Router","defaults","withCredentials","WINDOW_USER_SCRIPT_VARIABLE","loginUser","email","password","post","data","window","getUserProfile","get","getServerSideToken","req","signedCookies","token","user","getClientSideToken","getUserScript","redirectcUser","res","path","redirect","finished","push","authInitialProps","isProtectedRoute","auth","currentPath","url","location","pathname","isAnonymous","type","logoutUser"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport Router from 'next/router';\r\n\r\n\r\n// gets the cookie data???\r\naxios.defaults.withCredentials = true;\r\n\r\nconst WINDOW_USER_SCRIPT_VARIABLE = '__USER__';\r\n\r\nexport const loginUser = async (email, password) => {\r\n    const { data } = await axios.post('/api/login', { email, password });\r\n    if (typeof window !== 'undefined') {\r\n        window[WINDOW_USER_SCRIPT_VARIABLE] = data || {};\r\n    }\r\n\r\n}\r\n\r\nexport const getUserProfile = async () => {\r\n    const { data } = await axios.get('/api/profile');\r\n    return data;\r\n}\r\n\r\nexport const getServerSideToken = req => {\r\n    if (!req) {\r\n        return {};\r\n    }\r\n    const { signedCookies = {} } = req;\r\n    if (!signedCookies) {\r\n        return {};\r\n    } else if (!signedCookies.token) {\r\n        return {};\r\n    }\r\n    return { user: signedCookies.token }\r\n}\r\n\r\nexport const getClientSideToken = () => {\r\n    // checking if we are not on the client window\r\n    if (typeof window !== 'undefined') {\r\n        const user = window[WINDOW_USER_SCRIPT_VARIABLE] || {};\r\n        return { user };\r\n    }\r\n    return { user: [] }\r\n}\r\n\r\nexport const getUserScript = user => {\r\n    return `${WINDOW_USER_SCRIPT_VARIABLE} = ${JSON.stringify(user)}`\r\n}\r\n\r\n\r\n\r\nconst redirectcUser = (res, path) => {\r\n    if (res) {\r\n        // temporary redirect, significant for SEO??\r\n        res.redirect(302, path);\r\n        // finished property tells Next to not keep writing to the response\r\n        res.finished = true;\r\n        return {};\r\n    }\r\n    Router.push\r\n}\r\n\r\n\r\n\r\n// higer order function running a function???\r\nexport const authInitialProps = (isProtectedRoute) => ({ req, res }) => {\r\n    const auth = req ? getServerSideToken(req) : getClientSideToken()\r\n    const currentPath = req ? req.url : window.location.pathname;\r\n    const user = auth.user;\r\n    const isAnonymous = !user || user.type !== 'authenticated';\r\n    if (isProtectedRoute && isAnonymous && currentPath !== \"/login\") {\r\n        return redirectcUser(res, '/login');\r\n    }\r\n    return { auth };\r\n}\r\n\r\n//\r\n\r\nexport const logoutUser = async () => {\r\n    // checking if we are not on the client window\r\n    if (typeof window !== 'undefined') {\r\n        const user = window[WINDOW_USER_SCRIPT_VARIABLE] = {};\r\n    }\r\n    await axios.post('/api/logout');\r\n    Router.push('/login')\r\n}"]},"metadata":{},"sourceType":"module"}